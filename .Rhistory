train_y <- train_set %>% select(label) %>% pull()
test_set <- data[-index,]
test_x <- test_set %>% select(-label)
test_y <- test_set %>% select(label) %>% pull()
grid <- expand.grid(
eta = c(0.01, 0.1, 0.3),
max_depth = c(4, 6, 8),
subsample = c(0.7, 0.8, 0.9),
colsample_bytree = c(0.7, 0.8, 0.9)
)
param <- list(max_depth = 8,
eta = 0.1,
gamma = 0.8,
min_child_weight = 15,
subsample = 0.7,
lambda = 5,
alpha = 4,
colsample_bytree = 0.8,
eval_metric = "rmse")
dtrain <- as.matrix(train_x)
dtest <-  as.matrix(test_x)
dtrain <- xgb.DMatrix(dtrain, label = train_y)
dtest <- xgb.DMatrix(dtest, label = test_y)
watchlist <- list(train = dtrain, eval = dtest)
set.seed(101)
# results <- apply(grid, 1, function(params) {
#   xgb.cv(
#     params = as.list(params),
#     data = dtrain,
#     nrounds = 100,
#     nfold = 5,
#     early_stopping_rounds = 10,
#     verbose = TRUE
#   )
# })
set.seed(101)
bst <- xgb.train(param, dtrain, nrounds = 1000, watchlist, early_stopping_rounds = 10)
pred <- predict(bst, dtest)
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
plot(pred, test_set$label, abline(a = 0, b = 1))
rf <- randomForest::randomForest(label ~.,
data = train_set,
mtry = 2,
ntree = 1000
)
predict_rf <- predict(rf, test_set, type = "response")
MAE(predict_rf, test_set$label)
RMSE(predict_rf, test_set$label)
Metrics::mdae(predict_rf, test_set$label)
meta_data <- tibble(pred, predict_rf, label = test_set$label)
index2 <- createDataPartition(meta_data$label, p = 0.5, times = 1, list = FALSE)
train_set2 <- meta_data[index2,]
test_set2 <- meta_data[-index2,]
meta_model <- randomForest(label ~., data = train_set2)
predict_lm <- predict(meta_model, test_set2)
MAE(predict_lm, test_set2$label)
RMSE(predict_lm, test_set2$label)
Metrics::mdae(predict_lm, test_set2$label)
plot(predict_lm, test_set2$label, abline(a = 0, b = 1))
plot(predict_lm, test_set2$label, abline(a = 0, b = 1))
meta_model$coefs
meta_model$call
meta_model$predicted
meta_model$mse
meta_model
meta_model <- randomForest(label ~., data = train_set2, ntree = 1000, mtry = 2)
predict_lm <- predict(meta_model, test_set2)
MAE(predict_lm, test_set2$label)
RMSE(predict_lm, test_set2$label)
Metrics::mdae(predict_lm, test_set2$label)
plot(predict_lm, test_set2$label, abline(a = 0, b = 1))
meta_model <- randomForest(label ~., data = train_set2, ntree = 1000, mtry = 3)
predict_lm <- predict(meta_model, test_set2)
MAE(predict_lm, test_set2$label)
RMSE(predict_lm, test_set2$label)
Metrics::mdae(predict_lm, test_set2$label)
meta_model <- randomForest(label ~., data = train_set2, ntree = 1000, mtry = 1)
predict_lm <- predict(meta_model, test_set2)
MAE(predict_lm, test_set2$label)
RMSE(predict_lm, test_set2$label)
Metrics::mdae(predict_lm, test_set2$label)
plot(predict_lm, test_set2$label, abline(a = 0, b = 1))
meta_model <- lm(label ~., data = train_set2)
predict_lm <- predict(meta_model, test_set2)
MAE(predict_lm, test_set2$label)
RMSE(predict_lm, test_set2$label)
Metrics::mdae(predict_lm, test_set2$label)
meta_model <- lm(label ~., data = train_set2)
predict_lm <- predict(meta_model, test_set2)
MAE(predict_lm, test_set2$label)
RMSE(predict_lm, test_set2$label)
Metrics::mdae(predict_lm, test_set2$label)
meta_model <- lm(label ~., data = train_set2)
predict_lm <- predict(meta_model, test_set2)
MAE(predict_lm, test_set2$label)
RMSE(predict_lm, test_set2$label)
Metrics::mdae(predict_lm, test_set2$label)
meta_model <- lm(label ~., data = train_set2)
predict_lm <- predict(meta_model, test_set2)
MAE(predict_lm, test_set2$label)
RMSE(predict_lm, test_set2$label)
Metrics::mdae(predict_lm, test_set2$label)
plot(predict_lm, test_set2$label, abline(a = 0, b = 1))
meta_model <- lm(label ~., data = train_set2)
predict_lm <- predict(meta_model, test_set2)
MAE(predict_lm, test_set2$label)
RMSE(predict_lm, test_set2$label)
Metrics::mdae(predict_lm, test_set2$label)
MAE(predict_rf, test_set$label)
RMSE(predict_rf, test_set$label)
Metrics::mdae(predict_rf, test_set$label)
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
plot(pred, test_set$label, abline(a = 0, b = 1))
bst <- xgb.train(param, dtrain, nrounds = 1000, watchlist, early_stopping_rounds = 10)
mean_pred <- mean(meta_data$pred, meta_data$predict_rf)
means <- rowMeans(meta_data)
means
RMSE(means, test_set$label)
meta_data <- tibble(pred, predict_rf)
means <- rowMeans(meta_data)
RMSE(means, test_set$label)
RMSE(means, test_set$label)
Metrics::mdae(means, test_set$label)
RMSE(means, test_set$label)
meta_data
meta_data <- tibble(pred, predict_rf)
means <- rowMeans(meta_data)
RMSE(means, test_set$label)
Metrics::mdae(means, test_set$label)
plot(means, test_set$label, abline(a = 0, b = 1))
boxplot(test_set$label)
outlier(test_set$label)
IQR(data$label)
quantile(data$label)
outlier <- 4.91 + 1.5*IQR(data$label)
outlier
library(dplyr)
library(tidyverse)
library(caret)
library(FactoMineR)
library(ggbiplot)
library(xgboost)
library(randomForest)
set.seed(101)
data <- read_delim("qsar_fish_toxicity.csv", col_names = FALSE, delim = ";" ) %>% set_names(c("CIC0",
"SM1",
"GATS1i",
"NdsCH",
"NdssC",
"MLOGP",
"LC50"))
data <- data %>%
rename("label" = "LC50") %>%
filter(label < 7.54)
library(dplyr)
library(tidyverse)
library(caret)
library(FactoMineR)
library(ggbiplot)
library(xgboost)
library(randomForest)
set.seed(101)
data <- read_delim("qsar_fish_toxicity.csv", col_names = FALSE, delim = ";" ) %>% set_names(c("CIC0",
"SM1",
"GATS1i",
"NdsCH",
"NdssC",
"MLOGP",
"LC50"))
data <- data %>%
rename("label" = "LC50") %>%
filter(label < 7.54)
index <- createDataPartition(data$label, times = 1, p = 0.8, list = FALSE )
train_set <- data[index,]
train_x <- train_set %>% select(-label)
train_y <- train_set %>% select(label) %>% pull()
test_set <- data[-index,]
test_x <- test_set %>% select(-label)
test_y <- test_set %>% select(label) %>% pull()
library(dplyr)
library(tidyverse)
library(caret)
library(FactoMineR)
library(ggbiplot)
library(xgboost)
library(randomForest)
set.seed(101)
data <- read_delim("qsar_fish_toxicity.csv", col_names = FALSE, delim = ";" ) %>% set_names(c("CIC0",
"SM1",
"GATS1i",
"NdsCH",
"NdssC",
"MLOGP",
"LC50"))
data <- data %>%
rename("label" = "LC50") %>%
filter(label < 7.54)
index <- createDataPartition(data$label, times = 1, p = 0.8, list = FALSE )
train_set <- data[index,]
train_x <- train_set %>% select(-label)
train_y <- train_set %>% select(label) %>% pull()
test_set <- data[-index,]
test_x <- test_set %>% select(-label)
test_y <- test_set %>% select(label) %>% pull()
grid <- expand.grid(
eta = c(0.01, 0.1, 0.3),
max_depth = c(4, 6, 8),
subsample = c(0.7, 0.8, 0.9),
colsample_bytree = c(0.7, 0.8, 0.9)
)
param <- list(max_depth = 8,
eta = 0.1,
gamma = 0.8,
min_child_weight = 15,
subsample = 0.7,
lambda = 5,
alpha = 4,
colsample_bytree = 0.8,
eval_metric = "rmse")
dtrain <- as.matrix(train_x)
dtest <-  as.matrix(test_x)
dtrain <- xgb.DMatrix(dtrain, label = train_y)
dtest <- xgb.DMatrix(dtest, label = test_y)
watchlist <- list(train = dtrain, eval = dtest)
set.seed(101)
bst <- xgb.train(param, dtrain, nrounds = 1000, watchlist, early_stopping_rounds = 10)
pred <- predict(bst, dtest)
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
plot(pred, test_set$label, abline(a = 0, b = 1))
rf <- randomForest::randomForest(label ~.,
data = train_set,
mtry = 2,
ntree = 1000
)
predict_rf <- predict(rf, test_set, type = "response")
MAE(predict_rf, test_set$label)
RMSE(predict_rf, test_set$label)
Metrics::mdae(predict_rf, test_set$label)
meta_data <- tibble(pred, predict_rf)
means <- rowMeans(meta_data)
RMSE(means, test_set$label)
Metrics::mdae(means, test_set$label)
plot(means, test_set$label, abline(a = 0, b = 1))
dT
data
source("C:/Users/Mauricio/projects2/projects/QSAR/QSAR/script.R", echo = TRUE)
library(dplyr)
library(tidyverse)
library(caret)
library(FactoMineR)
library(ggbiplot)
library(xgboost)
library(randomForest)
set.seed(101)
data <- read_delim("qsar_fish_toxicity.csv", col_names = FALSE, delim = ";" ) %>% set_names(c("CIC0",
"SM1",
"GATS1i",
"NdsCH",
"NdssC",
"MLOGP",
"LC50"))
data <- data %>%
rename("label" = "LC50") %>%
filter(label < 7.54)
index <- createDataPartition(data$label, times = 1, p = 0.8, list = FALSE )
train_set <- data[index,]
train_x <- train_set %>% select(-label)
train_y <- train_set %>% select(label) %>% pull()
test_set <- data[-index,]
test_x <- test_set %>% select(-label)
test_y <- test_set %>% select(label) %>% pull()
grid <- expand.grid(
eta = c(0.01, 0.1, 0.3),
max_depth = c(4, 6, 8),
subsample = c(0.7, 0.8, 0.9),
colsample_bytree = c(0.7, 0.8, 0.9)
)
param <- list(max_depth = 8,
eta = 0.1,
gamma = 0.8,
min_child_weight = 15,
subsample = 0.7,
lambda = 5,
alpha = 4,
colsample_bytree = 0.8,
eval_metric = "rmse")
dtrain <- as.matrix(train_x)
dtest <-  as.matrix(test_x)
dtrain <- xgb.DMatrix(dtrain, label = train_y)
dtest <- xgb.DMatrix(dtest, label = test_y)
watchlist <- list(train = dtrain, eval = dtest)
set.seed(101)
set.seed(101)
bst <- xgb.train(param, dtrain, nrounds = 1000, watchlist, early_stopping_rounds = 10)
pred <- predict(bst, dtest)
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
plot(pred, test_set$label, abline(a = 0, b = 1))
rf <- randomForest::randomForest(label ~.,
data = train_set,
mtry = 2,
ntree = 1000
)
predict_rf <- predict(rf, test_set, type = "response")
MAE(predict_rf, test_set$label)
RMSE(predict_rf, test_set$label)
Metrics::mdae(predict_rf, test_set$label)
meta_data <- tibble(pred, predict_rf)
means <- rowMeans(meta_data)
RMSE(means, test_set$label)
Metrics::mdae(means, test_set$label)
plot(means, test_set$label, abline(a = 0, b = 1))
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
plot(pred, test_set$label, abline(a = 0, b = 1))
plot(pred, test_set$label, abline(a = 0, b = 1))
rf <- randomForest::randomForest(label ~.,
data = train_set,
mtry = 2,
ntree = 1000
)
predict_rf <- predict(rf, test_set, type = "response")
MAE(predict_rf, test_set$label)
RMSE(predict_rf, test_set$label)
Metrics::mdae(predict_rf, test_set$label)
meta_data <- tibble(pred, predict_rf)
means <- rowMeans(meta_data)
RMSE(means, test_set$label)
Metrics::mdae(means, test_set$label)
plot(means, test_set$label, abline(a = 0, b = 1))
library(dplyr)
library(tidyverse)
library(caret)
library(FactoMineR)
library(ggbiplot)
library(xgboost)
set.seed(101)
data <- read_delim("qsar_fish_toxicity.csv", col_names = FALSE, delim = ";" ) %>% set_names(c("CIC0",
"SM1_Dz(Z)",
"GATS1i",
"NdsCH",
"NdssC",
"MLOGP",
"LC50"))
colSums(is.na(data))
sum(is.null(data[1:nrow(data),]) == TRUE)
sum(is.na(data[1:nrow(data),]) == TRUE)
# summary(data$LC50)
#
#
# data %>%
#   ggplot(aes(LC50)) +
#   geom_histogram()
#
# data %>%
#   ggplot(aes(`SM1_Dz(Z)`, LC50))+
#   geom_point()
#
# data %>%
#   ggplot(aes(GATS1i, MLOGP))+
#   geom_point()
#
# data %>%
#   ggplot(aes(GATS1i, LC50))+
#   geom_point()
#
# data %>%
#   ggplot(aes(NdsCH, LC50))+
#   geom_point()
#
# data %>%
#   ggplot(aes(NdssC, LC50))+
#   geom_point()
#
# data %>%
#   ggplot(aes(MLOGP, LC50))+
#   geom_point()
data <- data %>%
rename("label" = "LC50") %>%
filter(label < 7.54)
index <- createDataPartition(data$label, times = 1, p = 0.8, list = FALSE )
train_set <- data[index,]
train_x <- train_set %>% select(-label)
train_y <- train_set %>% select(label) %>% pull()
test_set <- data[-index,]
test_x <- test_set %>% select(-label)
test_y <- test_set %>% select(label) %>% pull()
set.seed(101)
dtrain <- as.matrix(train_x)
dtest <-  as.matrix(test_x)
dtrain <- xgb.DMatrix(dtrain, label = train_y)
dtest <- xgb.DMatrix(dtest, label = test_y)
watchlist <- list(train = dtrain, eval = dtest)
param <- list(max_depth = 1,
eta = 0.05,
gamma = 0.5,
min_child_weight = 14,
subsample = 0.5,
lambda = 5,
alpha = 5,
colsample_bytree = 1,
eval_metric = "rmse")
bst <- xgb.train(param, dtrain, nrounds = 1000, watchlist, early_stopping_rounds = 50)
pred <- predict(bst, dtest)
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
set.seed(101)
dtrain <- as.matrix(train_x)
dtest <-  as.matrix(test_x)
dtrain <- xgb.DMatrix(dtrain, label = train_y)
dtest <- xgb.DMatrix(dtest, label = test_y)
watchlist <- list(train = dtrain, eval = dtest)
param <- list(max_depth = 8,
eta = 0.1,
gamma = 0.8,
min_child_weight = 15,
subsample = 0.7,
lambda = 5,
alpha = 4,
colsample_bytree = 0.8,
eval_metric = "rmse")
bst <- xgb.train(param, dtrain, nrounds = 1000, watchlist, early_stopping_rounds = 50)
pred <- predict(bst, dtest)
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
set.seed(101)
dtrain <- as.matrix(train_x)
dtest <-  as.matrix(test_x)
dtrain <- xgb.DMatrix(dtrain, label = train_y)
dtest <- xgb.DMatrix(dtest, label = test_y)
watchlist <- list(train = dtrain, eval = dtest)
param <- list(max_depth = 10,
eta = 0.1,
gamma = 0.8,
min_child_weight = 15,
subsample = 0.7,
lambda = 5,
alpha = 4,
colsample_bytree = 0.8,
eval_metric = "rmse")
bst <- xgb.train(param, dtrain, nrounds = 1000, watchlist, early_stopping_rounds = 50)
pred <- predict(bst, dtest)
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
set.seed(101)
dtrain <- as.matrix(train_x)
dtest <-  as.matrix(test_x)
dtrain <- xgb.DMatrix(dtrain, label = train_y)
dtest <- xgb.DMatrix(dtest, label = test_y)
watchlist <- list(train = dtrain, eval = dtest)
param <- list(max_depth = 10,
eta = 0.01,
gamma = 0.8,
min_child_weight = 15,
subsample = 0.7,
lambda = 5,
alpha = 4,
colsample_bytree = 0.8,
eval_metric = "rmse")
bst <- xgb.train(param, dtrain, nrounds = 1000, watchlist, early_stopping_rounds = 50)
pred <- predict(bst, dtest)
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
plot(pred, test_set$label, abline(a = 0, b = 1))
set.seed(101)
dtrain <- as.matrix(train_x)
dtest <-  as.matrix(test_x)
dtrain <- xgb.DMatrix(dtrain, label = train_y)
dtest <- xgb.DMatrix(dtest, label = test_y)
watchlist <- list(train = dtrain, eval = dtest)
param <- list(max_depth = 8,
eta = 0.1,
gamma = 0.8,
min_child_weight = 15,
subsample = 0.7,
lambda = 5,
alpha = 4,
colsample_bytree = 0.8,
eval_metric = "rmse")
bst <- xgb.train(param, dtrain, nrounds = 1000, watchlist, early_stopping_rounds = 50)
pred <- predict(bst, dtest)
MAE(pred, test_set$label)
RMSE(pred, test_set$label)
Metrics::mdae(pred, test_set$label)
library(dplyr)
library(tidyverse)
library(caret)
library(FactoMineR)
library(ggbiplot)
library(xgboost)
set.seed(101)
data <- read_delim("qsar_fish_toxicity.csv", col_names = FALSE, delim = ";" ) %>% set_names(c("CIC0",
"SM1_Dz(Z)",
"GATS1i",
"NdsCH",
"NdssC",
"MLOGP",
"LC50"))
hist(data$LC50)
mean(data$LC50>7.54)
